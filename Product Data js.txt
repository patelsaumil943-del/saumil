// Product Data
const products = [
    // Shoes
    {
        id: 1,
        title: "Premium Running Shoes",
        description: "Comfortable and durable running shoes with advanced cushioning technology.",
        price: 89.99,
        category: "shoes",
        image: "ðŸ‘Ÿ"
    },
    {
        id: 2,
        title: "Classic Leather Boots",
        description: "Timeless leather boots perfect for any occasion. Handcrafted quality.",
        price: 129.99,
        category: "shoes",
        image: "ðŸ¥¾"
    },
    {
        id: 3,
        title: "Sporty Sneakers",
        description: "Lightweight sneakers with breathable mesh design. Perfect for daily wear.",
        price: 69.99,
        category: "shoes",
        image: "ðŸ‘Ÿ"
    },
    {
        id: 4,
        title: "Elegant Dress Shoes",
        description: "Sophisticated dress shoes for formal events. Premium leather finish.",
        price: 149.99,
        category: "shoes",
        image: "ðŸ‘ž"
    },
    // Food
    {
        id: 5,
        title: "Gourmet Pizza Slice",
        description: "Delicious hand-tossed pizza with fresh ingredients and premium cheese.",
        price: 8.99,
        category: "food",
        image: "ðŸ•"
    },
    {
        id: 6,
        title: "Fresh Burger Combo",
        description: "Juicy beef burger with crispy fries and a refreshing drink included.",
        price: 12.99,
        category: "food",
        image: "ðŸ”"
    },
    {
        id: 7,
        title: "Sushi Platter",
        description: "Fresh sushi selection with salmon, tuna, and California rolls.",
        price: 24.99,
        category: "food",
        image: "ðŸ£"
    },
    {
        id: 8,
        title: "Taco Special",
        description: "Three authentic tacos with your choice of meat, fresh salsa, and guacamole.",
        price: 9.99,
        category: "food",
        image: "ðŸŒ®"
    },
    {
        id: 9,
        title: "Pasta Delight",
        description: "Creamy pasta with premium ingredients and homemade sauce.",
        price: 14.99,
        category: "food",
        image: "ðŸ"
    },
    // Clothes
    {
        id: 10,
        title: "Cotton T-Shirt",
        description: "Soft, breathable cotton t-shirt. Available in multiple colors and sizes.",
        price: 24.99,
        category: "clothes",
        image: "ðŸ‘•"
    },
    {
        id: 11,
        title: "Denim Jeans",
        description: "Classic fit denim jeans with stretch comfort. Perfect everyday wear.",
        price: 49.99,
        category: "clothes",
        image: "ðŸ‘–"
    },
    {
        id: 12,
        title: "Winter Jacket",
        description: "Warm and stylish winter jacket with water-resistant outer shell.",
        price: 89.99,
        category: "clothes",
        image: "ðŸ§¥"
    },
    {
        id: 13,
        title: "Summer Dress",
        description: "Elegant summer dress with floral pattern. Lightweight and comfortable.",
        price: 39.99,
        category: "clothes",
        image: "ðŸ‘—"
    },
    {
        id: 14,
        title: "Hooded Sweatshirt",
        description: "Cozy hooded sweatshirt perfect for casual wear. Premium quality fabric.",
        price: 44.99,
        category: "clothes",
        image: "ðŸ§¥"
    },
    {
        id: 15,
        title: "Formal Shirt",
        description: "Crisp formal shirt ideal for business and special occasions.",
        price: 34.99,
        category: "clothes",
        image: "ðŸ‘”"
    }
];

// Cart State
let cart = [];
let currentFilter = "all";
let searchQuery = "";

// DOM Elements
const productsGrid = document.getElementById("productsGrid");
const filterButtons = document.querySelectorAll(".filter-btn");
const searchInput = document.getElementById("searchInput");
const cartBtn = document.getElementById("cartBtn");
const cartModal = document.getElementById("cartModal");
const closeCart = document.getElementById("closeCart");
const cartItems = document.getElementById("cartItems");
const cartCount = document.getElementById("cartCount");
const cartTotal = document.getElementById("cartTotal");
const checkoutBtn = document.getElementById("checkoutBtn");
const hamburger = document.querySelector(".hamburger");
const navMenu = document.querySelector(".nav-menu");

// Initialize
document.addEventListener("DOMContentLoaded", () => {
    renderProducts();
    loadCart();
    setupEventListeners();
});

// Event Listeners
function setupEventListeners() {
    // Filter buttons
    filterButtons.forEach(btn => {
        btn.addEventListener("click", () => {
            filterButtons.forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            currentFilter = btn.dataset.category;
            renderProducts();
        });
    });

    // Search input
    searchInput.addEventListener("input", (e) => {
        searchQuery = e.target.value.toLowerCase();
        renderProducts();
    });

    // Cart modal
    cartBtn.addEventListener("click", () => {
        cartModal.classList.add("active");
        renderCart();
    });

    closeCart.addEventListener("click", () => {
        cartModal.classList.remove("active");
    });

    cartModal.addEventListener("click", (e) => {
        if (e.target === cartModal) {
            cartModal.classList.remove("active");
        }
    });

    // Checkout
    checkoutBtn.addEventListener("click", () => {
        if (cart.length === 0) {
            alert("Your cart is empty!");
            return;
        }
        alert(`Thank you for your purchase! Total: $${calculateTotal().toFixed(2)}`);
        cart = [];
        saveCart();
        updateCartUI();
        cartModal.classList.remove("active");
    });

    // Mobile menu
    hamburger.addEventListener("click", () => {
        navMenu.classList.toggle("active");
    });

    // Close mobile menu on link click
    document.querySelectorAll(".nav-menu a").forEach(link => {
        link.addEventListener("click", () => {
            navMenu.classList.remove("active");
        });
    });

    // Smooth scrolling
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute("href"));
            if (target) {
                target.scrollIntoView({
                    behavior: "smooth",
                    block: "start"
                });
            }
        });
    });
}

// Render Products
function renderProducts() {
    let filteredProducts = products;

    // Filter by category
    if (currentFilter !== "all") {
        filteredProducts = filteredProducts.filter(p => p.category === currentFilter);
    }

    // Filter by search query
    if (searchQuery) {
        filteredProducts = filteredProducts.filter(p =>
            p.title.toLowerCase().includes(searchQuery) ||
            p.description.toLowerCase().includes(searchQuery)
        );
    }

    // Render
    if (filteredProducts.length === 0) {
        productsGrid.innerHTML = `
            <div style="grid-column: 1/-1; text-align: center; padding: 3rem; color: var(--gray);">
                <i class="fas fa-search" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                <p style="font-size: 1.2rem;">No products found. Try a different search or filter.</p>
            </div>
        `;
        return;
    }

    productsGrid.innerHTML = filteredProducts.map(product => `
        <div class="product-card">
            <div class="product-image">${product.image}</div>
            <div class="product-info">
                <div class="product-category">${product.category}</div>
                <h3 class="product-title">${product.title}</h3>
                <p class="product-description">${product.description}</p>
                <div class="product-price">$${product.price.toFixed(2)}</div>
                <button class="add-to-cart" onclick="addToCart(${product.id})">
                    <i class="fas fa-cart-plus"></i> Add to Cart
                </button>
            </div>
        </div>
    `).join("");
}

// Cart Functions
function addToCart(productId) {
    const product = products.find(p => p.id === productId);
    if (!product) return;

    const existingItem = cart.find(item => item.id === productId);
    if (existingItem) {
        existingItem.quantity += 1;
    } else {
        cart.push({ ...product, quantity: 1 });
    }

    saveCart();
    updateCartUI();
    showNotification(`${product.title} added to cart!`);
}

function removeFromCart(productId) {
    cart = cart.filter(item => item.id !== productId);
    saveCart();
    updateCartUI();
    renderCart();
}

function updateQuantity(productId, change) {
    const item = cart.find(item => item.id === productId);
    if (!item) return;

    item.quantity += change;
    if (item.quantity <= 0) {
        removeFromCart(productId);
        return;
    }

    saveCart();
    updateCartUI();
    renderCart();
}

function calculateTotal() {
    return cart.reduce((total, item) => total + (item.price * item.quantity), 0);
}

function updateCartUI() {
    const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
    cartCount.textContent = totalItems;
    cartTotal.textContent = calculateTotal().toFixed(2);
}

function renderCart() {
    if (cart.length === 0) {
        cartItems.innerHTML = '<p class="empty-cart">Your cart is empty</p>';
        return;
    }

    cartItems.innerHTML = cart.map(item => `
        <div class="cart-item">
            <div class="cart-item-image">${item.image}</div>
            <div class="cart-item-info">
                <div class="cart-item-title">${item.title}</div>
                <div class="cart-item-price">$${item.price.toFixed(2)} Ã— ${item.quantity}</div>
            </div>
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                <button onclick="updateQuantity(${item.id}, -1)" style="background: var(--light-gray); border: none; width: 30px; height: 30px; border-radius: 5px; cursor: pointer;">-</button>
                <span>${item.quantity}</span>
                <button onclick="updateQuantity(${item.id}, 1)" style="background: var(--light-gray); border: none; width: 30px; height: 30px; border-radius: 5px; cursor: pointer;">+</button>
                <button class="cart-item-remove" onclick="removeFromCart(${item.id})">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
    `).join("");
}

// Local Storage
function saveCart() {
    localStorage.setItem("patelStoreCart", JSON.stringify(cart));
}

function loadCart() {
    const savedCart = localStorage.getItem("patelStoreCart");
    if (savedCart) {
        cart = JSON.parse(savedCart);
        updateCartUI();
    }
}

// Notification
function showNotification(message) {
    const notification = document.createElement("div");
    notification.style.cssText = `
        position: fixed;
        top: 100px;
        right: 20px;
        background: var(--gradient-blue);
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        z-index: 3000;
        animation: slideInRight 0.3s ease;
    `;
    notification.textContent = message;
    document.body.appendChild(notification);

    setTimeout(() => {
        notification.style.animation = "slideOutRight 0.3s ease";
        setTimeout(() => notification.remove(), 300);
    }, 2000);
}

// Add animation styles
const style = document.createElement("style");
style.textContent = `
    @keyframes slideInRight {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
    @keyframes slideOutRight {
        from {
            transform: translateX(0);
            opacity: 1;
        }
        to {
            transform: translateX(100%);
            opacity: 0;
        }
    }
`;
document.head.appendChild(style);

// Contact Form
const contactForm = document.getElementById("contactForm");
if (contactForm) {
    contactForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        
        const formData = new FormData(contactForm);
        const submitButton = contactForm.querySelector('.submit-btn');
        const originalText = submitButton.innerHTML;
        
        // Disable button and show loading
        submitButton.disabled = true;
        submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
        
        try {
            // Submit to Formspree
            const response = await fetch(contactForm.action, {
                method: 'POST',
                body: formData,
                headers: {
                    'Accept': 'application/json'
                }
            });
            
            if (response.ok) {
                showNotification("Message sent successfully! We'll get back to you soon.");
                contactForm.reset();
            } else {
                throw new Error('Form submission failed');
            }
        } catch (error) {
            // Fallback: Use mailto if Formspree fails
            const name = formData.get('name');
            const email = formData.get('email');
            const message = formData.get('message');
            const subject = encodeURIComponent(`Contact from ${name}`);
            const body = encodeURIComponent(`From: ${email}\n\n${message}`);
            window.location.href = `mailto:patelsaumil943@gmail.com?subject=${subject}&body=${body}`;
            showNotification("Opening email client... Please send the message manually.");
        } finally {
            submitButton.disabled = false;
            submitButton.innerHTML = originalText;
        }
    });
}
